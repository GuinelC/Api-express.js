extends layout

block content
  h1= "Admin Terrain"

  ul
    each terrain in terrains
      li
        a(href='/terrain/' + terrain.terrainId)= terrain.terrainName
        span(id=`terrain-dispo-${terrain.terrainId}`)= terrain.terrainDispo
        button(type='button' class='update-dispo-btn' data-terrain-id=terrain.terrainId)= 'Mettre à jour la disponibilité'

  script.
    document.addEventListener('DOMContentLoaded', function () {
      const updateButtons = document.querySelectorAll('.update-dispo-btn');

      updateButtons.forEach(button => {
        button.addEventListener('click', async function () {
          const terrainId = this.dataset.terrainId;

          try {
            const response = await fetch(`/update/${terrainId}`, {
              method: 'PUT',
              headers: {
                'Content-Type': 'application/json',
              },
            });

            if (response.ok) {
              const result = await response.json();

              if (result.success) {
                const terrainDispoSpan = document.getElementById(`terrain-dispo-${terrainId}`);
                if (terrainDispoSpan) {
                  terrainDispoSpan.innerText = result.newDispoValue;
                }

                alert('La disponibilité du terrain a été mise à jour avec succès.');
              } else {
                alert('Erreur lors de la mise à jour de la disponibilité du terrain: ' + result.message);
              }
            } else {
              alert('Erreur lors de la mise à jour de la disponibilité du terrain. Statut de la réponse: ' + response.status);
            }
          } catch (error) {
            console.error('Error updating terrain availability:', error);
            alert('Une erreur est survenue lors de la mise à jour de la disponibilité du terrain.');
          }
        });
      });
    });
